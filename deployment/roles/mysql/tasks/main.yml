---

# MySQL client のインストール
- name: install mysql client
  apt:
    name: "{{ item }}"
    update_cache: yes
  with_items:
    - mysql-client

# MySQL server のインストール
- name: install mysql server
  apt:
    name: "{{ item }}"
    update_cache: yes
  with_items:
    - mysql-server
    - python-mysqldb
  notify:
    - "restart mysqld"
  when: use_local_mysql_server

# MySQLのセットアップ
- name: start mysqld
  service:
    name: mysql
    state: started
  when: use_local_mysql_server
- name: setup user for haro
  mysql_user:
    name: "{{ MYSQL.USER_NAME }}"
    priv: "{{ MYSQL.PRIVILEGE }}"
    host: "{{ MYSQL.HOSTS }}"
  when: use_local_mysql_server
  tags: [configure]
- name: setup db for haro
  mysql_db:
    login_user: "{{ MYSQL.USER_NAME }}"
    login_password: '{{ MYSQL.PASSWORD }}'
    name: "{{ MYSQL.DB_NAME }}"
    encoding: "{{ MYSQL.ENCODING }}"
  when: use_local_mysql_server
  tags: [configure]
